<ion-header>
  <ion-toolbar>
    <ion-title>Registro con C谩mara, Audio y An谩lisis</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- PASO 1: PERMISOS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>1锔 Solicitar permisos</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>
        Para continuar, la aplicaci贸n necesita acceso a la c谩mara y al micr贸fono.
      </p>

      <ion-button expand="block" (click)="requestPermissions()">
        Solicitar permisos
      </ion-button>

      <p class="ion-margin-top">
         C谩mara:
        <strong>
          {{ cameraGranted === true ? 'Concedido' :
             cameraGranted === false ? 'Denegado' : 'No solicitado' }}
        </strong>
      </p>

      <p>
         Micr贸fono:
        <strong>
          {{ micGranted === true ? 'Concedido' :
             micGranted === false ? 'Denegado' : 'No solicitado' }}
        </strong>
      </p>
    </ion-card-content>
  </ion-card>

  <!-- PASO 2: CMARA -->
  <ion-card *ngIf="cameraGranted">
    <ion-card-header>
      <ion-card-title>2锔 Vista previa de la c谩mara</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>
        A continuaci贸n se muestra la imagen en tiempo real de la c谩mara.
      </p>

      <video
        id="video"
        autoplay
        playsinline
        style="width: 100%; border-radius: 8px;"
      ></video>

      <ion-button
        expand="block"
        color="primary"
        class="ion-margin-top"
        (click)="takePhoto()"
      >
        Tomar foto
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- FOTO CAPTURADA -->
  <ion-card *ngIf="photoDataUrl">
    <ion-card-header>
      <ion-card-title> Foto capturada</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <img [src]="photoDataUrl" style="width: 100%; border-radius: 8px;" />
    </ion-card-content>
  </ion-card>

  <!-- PASO 3: AUDIO -->
  <ion-card *ngIf="micGranted">
    <ion-card-header>
      <ion-card-title>3锔 Grabaci贸n de audio</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>
        Al presionar el bot贸n, se grabar谩 audio durante 5 segundos de forma autom谩tica.
      </p>

      <ion-button
        expand="block"
        color="secondary"
        (click)="recordAudio()"
      >
        Grabar audio (5 segundos)
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- REPRODUCCIN DE AUDIO -->
  <ion-card *ngIf="audioUrl">
    <ion-card-header>
      <ion-card-title> Audio grabado</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <audio [src]="audioUrl" controls style="width: 100%;"></audio>
    </ion-card-content>
  </ion-card>

  <!-- PASO 4: TEXTO -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>4锔 Descripci贸n de la captura</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>
        Escribe una breve descripci贸n de lo que acabas de registrar.
      </p>

      <ion-textarea
        placeholder="Ejemplo: Estoy probando la c谩mara y el micr贸fono"
        [(ngModel)]="descriptionText"
      ></ion-textarea>

      <ion-button
        expand="block"
        class="ion-margin-top"
        (click)="analyzeText()"
        [disabled]="analyzing"
      >
        Analizar texto
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- RESULTADO DEL ANLISIS -->
  <ion-card *ngIf="sentimentResult">
    <ion-card-header>
      <ion-card-title> Resultado del an谩lisis</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>
        <strong>Sentimiento detectado:</strong>
        {{ sentimentResult.label }}
      </p>

      <p>
        <strong>Nivel de confianza:</strong>
        {{ sentimentResult.score | percent:'1.0-2' }}
      </p>
    </ion-card-content>
  </ion-card>

</ion-content>
